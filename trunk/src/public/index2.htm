<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>szMail</title>
<link rel="stylesheet" href="css/layout2.css" />

<script type="text/javascript" src="lib/yabble.js"></script>
<script type="text/javascript" src="lib/jquery.js"></script>
<script type="text/javascript" src="lib/jquery.tmpl.js"></script>
<script type="text/javascript" src="folders.js"></script>
<script type="text/javascript" src="mails.js"></script>
<!-- <script type="text/javascript" src="frontend.js"></script> -->

<script type="text/javascript">
function loadTemplate(id, url) {
	var data = $.ajax({ type: "GET", url: url, async: false }).responseText;
	$.template(id, data);
}

function getTemplate(id) {
	$.template(id);
}

function toDate(str)
{
	var months = {'Jan':1,'Feb':2,'Mar':3,'Apr':4,'May':5,'Jun':6,'Jul':7,'Aug':8,'Sep':9,'Oct':10,'Nov':11,'Dec':12};
	// Wed, 10 Mar 2010 22:55:11 +0100
	var str = str.split(' ');
	var daytime = str[4].split(':');
	return new Date(str[3], months[str[2]], str[1], daytime[0], daytime[1], daytime[2]);
}

function convenienceDate(str){
	var date = toDate(str);
	return date.toDateString();
}

$(function () {

	loadTemplate('folderview_item','tpl/_folderview_item.tpl');
	loadTemplate('folderlist_item','tpl/_folderlist_item.tpl');
	
	loadTemplate('folderview','tpl/folderview.tpl');
	loadTemplate('breadcrumbs','tpl/breadcrumbs.tpl');
	loadTemplate('inbox_switcher','tpl/inbox_switcher.tpl');
	loadTemplate('inbox_navigation','tpl/inbox_navigation.tpl');
	loadTemplate('sidebar','tpl/sidebar.tpl');
	loadTemplate('content','tpl/content.tpl');
	
	loadTemplate('universalbar','tpl/universalbar.tpl');
	
	loadTemplate('footer','tpl/footer.tpl');
	loadTemplate('header','tpl/header.tpl');
	loadTemplate('layout','tpl/layout.tpl');
	
	loadTemplate('login_form','tpl/login/form.tpl');
	
	loadTemplate('settingsview','tpl/settings/settings.tpl');
	
	$.tmpl('layout').prependTo('body');
	
	$.tmpl('login_form').prependTo('#wrapper');

	$.tmpl('settingsview').appendTo('#content_wrapper');
	//showContent();
	
	//$(document).click(function(){
	//	$('#main').toggleClass('login');
	//	$('#navigation, #content').toggleClass('visible');
	//});
});


function showContent()
{
	$.tmpl('folderview').appendTo('#content_wrapper');

	$(".dropdown dt").click(function() {
		$(".dropdown dt").css("-moz-border-radius","3px 3px 0 0");
	    $(".dropdown dd ul").toggle();
	});
	
    $(document).bind('click', function(e) {
        var $clicked = $(e.target);
        if (! $clicked.parents().hasClass("dropdown"))
        {
        	$(".dropdown dt").css("-moz-border-radius","3px");
        	$(".dropdown dd ul").hide();
        }
            
    });

    
	var folders_ = $('#folders');
	$.each(folders.folders, function(index, folder) {
		$.tmpl('folderlist_item', folder).appendTo(folders_);
	});
	
	
	var tbody = $('tbody');
	$.each(mails.mails, function(index, mail) {
		$.tmpl('folderview_item' ,mail).appendTo(tbody);
	});	
};
</script>
</head>
<body></body>
</html>