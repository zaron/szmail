<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>szMail Testbench</title>
<style type="text/css">body{font-family:monospace;}.TRANSMIT{color:#883;}.RECEIVE{color:#838;}</style>
<script type="text/javascript" src="lib/yabble.js"></script>
<script type="text/javascript" src="lib/jquery.js"></script>
<script type="text/javascript">
function log(msg,level){
	$('#debug').prepend("<span class=\""+level+"\">"+(new Date()) +" :" +msg + '</span><br/>');
}

function log_frontend(msg) {
	$('#debug').prepend("<span>Frontend: " +msg + '</span><br/>');
}

$(function() {
	require.reset();
	require.setModuleRoot('modules');
	require.ensure( [ 'json', 'net' ], function(require) {
		json = require('json');
		net = require('net');
		$('#invoke').click(function(){
			net.createJSONRPCRequest(function(request){
				request.setMethod($('#method').val());
				var args = [];
				if($('#arg1').val()) args.push(eval(('(' + (arg1) + ')')));
				if($('#arg2').val()) args.push(eval(('(' + ($('#arg2').val()) + ')')));
				if($('#arg3').val()) args.push(eval(('(' + ($('#arg3').val()) + ')')));
				request.write(args);
				request.on("success", log_frontend);
				request.on("error", log_frontend || noop);
			}).send('/rpc', {method : net.HTTP_METHOD_POST});
		});
	});
});

</script>
</head>
<body>
<div>method:<input type="text" id="method" />(<input type="text" id="arg1" />,<input type="text" id="arg2" />,<input type="text" id="arg3" />) <button id="invoke">invoke</button></div>
<hr />
<div id="debug"></div>
</body>

</html>